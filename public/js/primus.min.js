!function(t,e,n,r){e[t]=n.call(e);for(var o=0;o<r.length;o++)r[o](e[t]);"undefined"!=typeof module&&module.exports?module.exports=e[t]:"function"==typeof define&&define.amd&&define(function(){return e[t]})}("Primus",this||{},function(){var t=function i(s,c,a){function u(e,t){if(!c[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(f)return f(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[e]={exports:{}};s[e][0].call(o.exports,function(t){return u(s[e][1][t]||t)},o,o.exports,i,s,c,a)}return c[e].exports}for(var f="function"==typeof require&&require,t=0;t<a.length;t++)u(a[t]);return u}({1:[function(t,e,n){"use strict";e.exports=function(r,i){var s=/[, ]+/;function o(t,e){if(i[t]){if("string"==typeof i[t]&&(i[t]=i[t].split(s)),"function"==typeof i[t])return i[t].call(e);for(var n,r,o=0;o<i[t].length;o++)"function"==(n=typeof(r=i[t][o]))?r.call(e):"string"==n&&"function"==typeof e[r]&&e[r]()}}return i=i||{},"string"==typeof(r=r||[])&&(r=r.split(s)),function(){var t,e=this,n=0;if(null===e[r[0]])return!1;for(o("before",e);n<r.length;n++)e[t=r[n]]&&("function"==typeof e[t].destroy&&e[t].destroy(),e[t]=null);return e.emit&&e.emit("destroy"),o("after",e),!0}}},{}],2:[function(t,e,n){"use strict";e.exports=function(){for(var r,o=this,t=0,e=arguments.length,i=new Array(e);t<e;t++)i[t]=arguments[t];return"function"!=typeof i[i.length-1]?function(){for(var t=0,e=arguments.length,n=new Array(e);t<e;t++)n[t]=arguments[t];return o.emit.apply(o,i.concat(n))}:(r=i.pop(),function(){for(var t=0,e=arguments.length,n=new Array(e+1);t<e;t++)n[t+1]=arguments[t];return n[0]=function(t,e){if(t)return o.emit("error",t);n=void 0===e?n.slice(1):null===e?[]:e,o.emit.apply(o,i.concat(n))},r.apply(o,n),!0})}},{}],3:[function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,h="~";function o(){}function c(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new c(n,r||t,o),s=h?h+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],i]:t._events[s].push(i):(t._events[s]=i,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(h=!1)),s.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(h?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},s.prototype.listeners=function(t){var e=h?h+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,i=new Array(o);r<o;r++)i[r]=n[r].fn;return i},s.prototype.listenerCount=function(t){var e=h?h+t:t,n=this._events[e];return n?n.fn?1:n.length:0},s.prototype.emit=function(t,e,n,r,o,i){var s=h?h+t:t;if(!this._events[s])return!1;var c,a=this._events[s],u=arguments.length;if(a.fn){switch(a.once&&this.removeListener(t,a.fn,void 0,!0),u){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,e),!0;case 3:return a.fn.call(a.context,e,n),!0;case 4:return a.fn.call(a.context,e,n,r),!0;case 5:return a.fn.call(a.context,e,n,r,o),!0;case 6:return a.fn.call(a.context,e,n,r,o,i),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];a.fn.apply(a.context,c)}else for(var f,p=a.length,l=0;l<p;l++)switch(a[l].once&&this.removeListener(t,a[l].fn,void 0,!0),u){case 1:a[l].fn.call(a[l].context);break;case 2:a[l].fn.call(a[l].context,e);break;case 3:a[l].fn.call(a[l].context,e,n);break;case 4:a[l].fn.call(a[l].context,e,n,r);break;default:if(!c)for(f=1,c=new Array(u-1);f<u;f++)c[f-1]=arguments[f];a[l].fn.apply(a[l].context,c)}return!0},s.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,n,r){var o=h?h+t:t;if(!this._events[o])return this;if(!e)return u(this,o),this;var i=this._events[o];if(i.fn)i.fn!==e||r&&!i.once||n&&i.context!==n||u(this,o);else{for(var s=0,c=[],a=i.length;s<a;s++)(i[s].fn!==e||r&&!i[s].once||n&&i[s].context!==n)&&c.push(i[s]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=h?h+t:t,this._events[e]&&u(this,e)):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=h,s.EventEmitter=s,void 0!==e&&(e.exports=s)},{}],4:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){var n;e&&(t.super_=e,(n=function(){}).prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t)}},{}],5:[function(t,e,n){"use strict";var o=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i");e.exports=function(t){var e,n,r=typeof t;if("number"==r)return t;if("string"!=r||"0"===t||!t)return 0;if(+t)return+t;if(1e4<t.length||!(n=o.exec(t)))return 0;switch(e=parseFloat(n[1]),n[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 31536e6*e;case"weeks":case"week":case"wks":case"wk":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;default:return e}}},{}],6:[function(t,e,n){"use strict";e.exports=function(t){var e,n=0;function r(){return n||(n=1,e=t.apply(this,arguments),t=null),e}return r.displayName=t.displayName||t.name||r.displayName||r.name,r}},{}],7:[function(t,e,n){var r,o,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(t){o=c}}();var u,f=[],p=!1,l=-1;function h(){p&&u&&(p=!1,u.length?f=u.concat(f):l=-1,f.length&&m())}function m(){if(!p){var t=a(h);p=!0;for(var e=f.length;e;){for(u=f,f=[];++l<e;)u&&u[l].run();l=-1,e=f.length}u=null,p=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];f.push(new d(t,e)),1!==f.length||p||a(m)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],8:[function(t,e,n){"use strict";var i=Object.prototype.hasOwnProperty;function s(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}n.stringify=function(t,e){e=e||"";var n,r,o=[];for(r in"string"!=typeof e&&(e="?"),t)if(i.call(t,r)){if((n=t[r])||null!=n&&!isNaN(n)||(n=""),r=encodeURIComponent(r),n=encodeURIComponent(n),null===r||null===n)continue;o.push(r+"="+n)}return o.length?e+o.join("&"):""},n.parse=function(t){for(var e,n=/([^=?&]+)=?([^&]*)/g,r={};e=n.exec(t);){var o=s(e[1]),i=s(e[2]);null===o||null===i||o in r||(r[o]=i)}return r}},{}],9:[function(t,e,n){"use strict";var r=t("eventemitter3"),o=t("millisecond"),i=t("demolish"),s=t("tick-tock"),c=t("one-time");function a(t,e,n){return o(t in n?n[t]:t in e?e[t]:u[t])}function u(t){var e=this;if(!(e instanceof u))return new u(t);t=t||{},e.attempt=null,e._fn=null,e["reconnect timeout"]=a("reconnect timeout",e,t),e.retries=a("retries",e,t),e.factor=a("factor",e,t),e.max=a("max",e,t),e.min=a("min",e,t),e.timers=new s(e)}((u.prototype=new r).constructor=u)["reconnect timeout"]="30 seconds",u.max=1/0,u.min="500 ms",u.retries=10,u.factor=2,u.prototype.reconnect=function(){var n=this;return n.backoff(function(t,e){return e.duration=new Date-e.start,t?n.emit("reconnect failed",t,e):void n.emit("reconnected",e)},n.attempt)},u.prototype.backoff=function(n,r){var o=this;return(r=r||o.attempt||{}).backoff?o:(r["reconnect timeout"]=a("reconnect timeout",o,r),r.retries=a("retries",o,r),r.factor=a("factor",o,r),r.max=a("max",o,r),r.min=a("min",o,r),r.start=+r.start||+new Date,r.duration=+r.duration||0,r.attempt=+r.attempt||0,r.attempt===r.retries?n.call(o,new Error("Unable to recover"),r):(r.backoff=!0,r.attempt++,(o.attempt=r).scheduled=1!==r.attempt?Math.min(Math.round((Math.random()+1)*r.min*Math.pow(r.factor,r.attempt-1)),r.max):r.min,o.timers.setTimeout("reconnect",function(){r.duration=new Date-r.start,r.backoff=!1,o.timers.clear("reconnect, timeout");var e=o._fn=c(function(t){return o.reset(),t?o.backoff(n,r):void n.call(o,void 0,r)});o.emit("reconnect",r,e),o.timers.setTimeout("timeout",function(){var t=new Error("Failed to reconnect in a timely manner");r.duration=new Date-r.start,o.emit("reconnect timeout",t,r),e(t)},r["reconnect timeout"])},r.scheduled),o.emit("reconnect scheduled",r)),o)},u.prototype.reconnecting=function(){return!!this.attempt},u.prototype.reconnected=function(t){return this._fn&&this._fn(t),this},u.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},u.prototype.destroy=i("timers attempt _fn"),e.exports=u},{demolish:1,eventemitter3:10,millisecond:5,"one-time":6,"tick-tock":12}],10:[function(t,e,n){"use strict";var h="function"!=typeof Object.create&&"~";function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function r(){}r.prototype._events=void 0,r.prototype.listeners=function(t,e){var n=h?h+t:t,r=this._events&&this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},r.prototype.emit=function(t,e,n,r,o,i){var s=h?h+t:t;if(!this._events||!this._events[s])return!1;var c,a=this._events[s],u=arguments.length;if("function"==typeof a.fn){switch(a.once&&this.removeListener(t,a.fn,void 0,!0),u){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,e),!0;case 3:return a.fn.call(a.context,e,n),!0;case 4:return a.fn.call(a.context,e,n,r),!0;case 5:return a.fn.call(a.context,e,n,r,o),!0;case 6:return a.fn.call(a.context,e,n,r,o,i),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];a.fn.apply(a.context,c)}else for(var f,p=a.length,l=0;l<p;l++)switch(a[l].once&&this.removeListener(t,a[l].fn,void 0,!0),u){case 1:a[l].fn.call(a[l].context);break;case 2:a[l].fn.call(a[l].context,e);break;case 3:a[l].fn.call(a[l].context,e,n);break;default:if(!c)for(f=1,c=new Array(u-1);f<u;f++)c[f-1]=arguments[f];a[l].fn.apply(a[l].context,c)}return!0},r.prototype.on=function(t,e,n){var r=new i(e,n||this),o=h?h+t:t;return this._events||(this._events=h?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.once=function(t,e,n){var r=new i(e,n||this,!0),o=h?h+t:t;return this._events||(this._events=h?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.removeListener=function(t,e,n,r){var o=h?h+t:t;if(!this._events||!this._events[o])return this;var i=this._events[o],s=[];if(e)if(i.fn)(i.fn!==e||r&&!i.once||n&&i.context!==n)&&s.push(i);else for(var c=0,a=i.length;c<a;c++)(i[c].fn!==e||r&&!i[c].once||n&&i[c].context!==n)&&s.push(i[c]);return s.length?this._events[o]=1===s.length?s[0]:s:delete this._events[o],this},r.prototype.removeAllListeners=function(t){return this._events&&(t?delete this._events[h?h+t:t]:this._events=h?{}:Object.create(null)),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=h,void 0!==e&&(e.exports=r)},{}],11:[function(t,e,n){"use strict";e.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},{}],12:[function(t,f,e){(function(r,e){"use strict";var i=Object.prototype.hasOwnProperty,s=t("millisecond");function c(t,e,n,r){this.start=+new Date,this.duration=n,this.clear=e,this.timer=t,this.fns=[r]}function a(t){clearTimeout(t)}function u(t){clearInterval(t)}function o(t){e(t)}function n(t){if(!(this instanceof n))return new n(t);this.timers={},this.context=t||this}c.prototype.remaining=function(){return this.duration-this.taken()},c.prototype.taken=function(){return new Date-this.start},n.prototype.tock=function(r,o){var i=this;return function(){if(r in i.timers){var t=i.timers[r].fns.slice(),e=t.length,n=0;for(o?i.clear(r):i.start=+new Date;n<e;n++)t[n].call(i.context)}}},n.prototype.setTimeout=function(t,e,n){var r,o=this;return o.timers[t]?o.timers[t].fns.push(e):(r=s(n),o.timers[t]=new c(setTimeout(o.tock(t,!0),s(n)),a,r,e)),o},n.prototype.setInterval=function(t,e,n){var r,o=this;return o.timers[t]?o.timers[t].fns.push(e):(r=s(n),o.timers[t]=new c(setInterval(o.tock(t),s(n)),u,r,e)),o},n.prototype.setImmediate=function(t,e){var n=this;return"function"!=typeof r?n.setTimeout(t,e,0):(n.timers[t]?n.timers[t].fns.push(e):n.timers[t]=new c(r(n.tock(t,!0)),o,0,e),n)},n.prototype.active=function(t){return t in this.timers},n.prototype.clear=function(){var t,e,n,r=arguments.length?arguments:[],o=this;if(1===r.length&&"string"==typeof r[0]&&(r=r[0].split(/[, ]+/)),!r.length)for(t in o.timers)i.call(o.timers,t)&&r.push(t);for(e=0,n=r.length;e<n;e++)(t=o.timers[r[e]])&&(t.clear(t.timer),t.fns=t.timer=t.clear=null,delete o.timers[r[e]]);return o},n.prototype.adjust=function(t,e){var n,r=s(e),o=this.timers[t];return o&&(n=o.clear===u,o.clear(o.timer),o.start=+new Date,o.duration=r,o.timer=(n?setInterval:setTimeout)(this.tock(t,!n),r)),this},n.prototype.end=n.prototype.destroy=function(){return!!this.context&&(this.clear(),!(this.context=this.timers=null))},n.Timer=c,f.exports=n}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{millisecond:5,timers:13}],13:[function(a,t,u){(function(t,e){var r=a("process/browser.js").nextTick,n=Function.prototype.apply,o=Array.prototype.slice,i={},s=0;function c(t,e){this._id=t,this._clearFn=e}u.setTimeout=function(){return new c(n.call(setTimeout,window,arguments),clearTimeout)},u.setInterval=function(){return new c(n.call(setInterval,window,arguments),clearInterval)},u.clearTimeout=u.clearInterval=function(t){t.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},u.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},u.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},u._unrefActive=u.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},u.setImmediate="function"==typeof t?t:function(t){var e=s++,n=!(arguments.length<2)&&o.call(arguments,1);return i[e]=!0,r(function(){i[e]&&(n?t.apply(null,n):t.call(null),u.clearImmediate(e))}),e},u.clearImmediate="function"==typeof e?e:function(t){delete i[t]}}).call(this,a("timers").setImmediate,a("timers").clearImmediate)},{"process/browser.js":7,timers:13}],14:[function(t,r,e){(function(s){"use strict";var h=t("requires-port"),m=t("querystringify"),c=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,n=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,e=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function d(t){return(t||"").toString().replace(e,"")}var y=[["#","hash"],["?","query"],function(t){return t.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],a={hash:1,query:1};function v(t){var e,n="undefined"!=typeof window?window:void 0!==s?s:"undefined"!=typeof self?self:{},r=n.location||{},o={},i=typeof(t=t||r);if("blob:"===t.protocol)o=new w(unescape(t.pathname),{});else if("string"==i)for(e in o=new w(t,{}),a)delete o[e];else if("object"==i){for(e in t)e in a||(o[e]=t[e]);void 0===o.slashes&&(o.slashes=c.test(t.href))}return o}function g(t){t=d(t);var e=n.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function w(t,e,n){if(t=d(t),!(this instanceof w))return new w(t,e,n);var r,o,i,s,c,a,u=y.slice(),f=typeof e,p=this,l=0;for("object"!=f&&"string"!=f&&(n=e,e=null),n&&"function"!=typeof n&&(n=m.parse),e=v(e),r=!(o=g(t||"")).protocol&&!o.slashes,p.slashes=o.slashes||r&&e.slashes,p.protocol=o.protocol||e.protocol||"",t=o.rest,o.slashes||(u[3]=[/(.*)/,"pathname"]);l<u.length;l++)"function"!=typeof(s=u[l])?(i=s[0],a=s[1],i!=i?p[a]=t:"string"==typeof i?~(c=t.indexOf(i))&&(t="number"==typeof s[2]?(p[a]=t.slice(0,c),t.slice(c+s[2])):(p[a]=t.slice(c),t.slice(0,c))):(c=i.exec(t))&&(p[a]=c[1],t=t.slice(0,c.index)),p[a]=p[a]||r&&s[3]&&e[a]||"",s[4]&&(p[a]=p[a].toLowerCase())):t=s(t);n&&(p.query=n(p.query)),r&&e.slashes&&"/"!==p.pathname.charAt(0)&&(""!==p.pathname||""!==e.pathname)&&(p.pathname=function(t,e){if(""===t)return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,o=n[r-1],i=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(i=!0),n.splice(r,1),s--);return i&&n.unshift(""),"."!==o&&".."!==o||n.push(""),n.join("/")}(p.pathname,e.pathname)),h(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(s=p.auth.split(":"),p.username=s[0]||"",p.password=s[1]||""),p.origin=p.protocol&&p.host&&"file:"!==p.protocol?p.protocol+"//"+p.host:"null",p.href=p.toString()}w.prototype={set:function(t,e,n){var r,o=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(n||m.parse)(e)),o[t]=e;break;case"port":o[t]=e,h(e,o.protocol)?e&&(o.host=o.hostname+":"+e):(o.host=o.hostname,o[t]="");break;case"hostname":o[t]=e,o.port&&(e+=":"+o.port),o.host=e;break;case"host":o[t]=e,/:\d+$/.test(e)?(e=e.split(":"),o.port=e.pop(),o.hostname=e.join(":")):(o.hostname=e,o.port="");break;case"protocol":o.protocol=e.toLowerCase(),o.slashes=!n;break;case"pathname":case"hash":e?(r="pathname"===t?"/":"#",o[t]=e.charAt(0)!==r?r+e:e):o[t]=e;break;default:o[t]=e}for(var i=0;i<y.length;i++){var s=y[i];s[4]&&(o[s[1]]=o[s[1]].toLowerCase())}return o.origin=o.protocol&&o.host&&"file:"!==o.protocol?o.protocol+"//"+o.host:"null",o.href=o.toString(),o},toString:function(t){t&&"function"==typeof t||(t=m.stringify);var e,n=this,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var o=r+(n.slashes?"//":"");return n.username&&(o+=n.username,n.password&&(o+=":"+n.password),o+="@"),o+=n.host+n.pathname,(e="object"==typeof n.query?t(n.query):n.query)&&(o+="?"!==e.charAt(0)?"?"+e:e),n.hash&&(o+=n.hash),o}},w.extractProtocol=g,w.location=v,w.trimLeft=d,w.qs=m,r.exports=w}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:8,"requires-port":11}],15:[function(t,e,n){"use strict";var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,s={},c=0,a=0;function u(t){for(var e="";e=o[t%i]+e,0<(t=Math.floor(t/i)););return e}function f(){var t=u(+new Date);return t!==r?(c=0,r=t):t+"."+u(c++)}for(;a<i;a++)s[o[a]]=a;f.encode=u,f.decode=function(t){var e=0;for(a=0;a<t.length;a++)e=e*i+s[t.charAt(a)];return e},e.exports=f},{}],16:[function(e,t,n){"use strict";var r,o,i,s,c=e("eventemitter3"),a=e("tick-tock"),u=e("recovery"),f=e("querystringify"),p=e("inherits"),l=e("demolish"),h=e("yeast"),m=/\u2028/g,d=/\u2029/g;function y(t,e){if(!(t instanceof v)){var n=new Error("Primus#"+e+"'s context should called with a Primus instance");if("function"!=typeof t.listeners||!t.listeners("error").length)throw n;t.emit("error",n)}}try{r=location.origin?location.origin:location.protocol+"//"+location.host}catch(t){r="http://127.0.0.1"}function v(t,e){if(!(this instanceof v))return new v(t,e);if(v.Stream.call(this),"function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));if("object"==typeof t?t=(e=t).url||e.uri||r:e=e||{},"ping"in e||"pong"in e)return this.critical(new Error("The `ping` and `pong` options have been removed"));var n=this;e.queueSize="queueSize"in e?e.queueSize:1/0,e.timeout="timeout"in e?e.timeout:1e4,e.reconnect="reconnect"in e?e.reconnect:{},e.pingTimeout="pingTimeout"in e?e.pingTimeout:45e3,e.strategy="strategy"in e?e.strategy:[],e.transport="transport"in e?e.transport:{},n.buffer=[],n.writable=!0,n.readable=!0,n.url=n.parse(t||r),n.readyState=v.CLOSED,n.options=e,n.timers=new a(this),n.socket=null,n.disconnect=!1,n.transport=e.transport,n.transformers={outgoing:[],incoming:[]},n.recovery=new u(e.reconnect),"string"==typeof e.strategy&&(e.strategy=e.strategy.split(/\s?,\s?/g)),!1===e.strategy?e.strategy=[]:e.strategy.length||(e.strategy.push("disconnect","online"),this.authorization||e.strategy.push("timeout")),e.strategy=e.strategy.join(",").toLowerCase(),"websockets"in e&&(n.AVOID_WEBSOCKETS=!e.websockets),"network"in e&&(n.NETWORK_EVENTS=e.network),e.manual||n.timers.setTimeout("open",function(){n.timers.clear("open"),n.open()},0),n.initialise(e)}v.requires=v.require=function(t){if("function"==typeof e)return e(t)};try{v.Stream=v.requires("stream")}catch(t){}v.Stream||(v.Stream=c),p(v,v.Stream),v.OPENING=1,v.CLOSED=2,v.OPEN=3,v.prototype.AVOID_WEBSOCKETS=!1,v.prototype.NETWORK_EVENTS=!1,v.prototype.online=!0;try{(v.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(v.prototype.online=!1))}catch(t){}v.prototype.ark={},v.prototype.emits=e("emits"),v.prototype.plugin=function(t){if(y(this,"plugin"),t)return this.ark[t];var e={};for(t in this.ark)e[t]=this.ark[t];return e},v.prototype.reserved=function(t){return/^(incoming|outgoing)::/.test(t)||t in this.reserved.events},v.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,destroy:1,online:1,error:1,close:1,open:1,data:1,end:1},v.prototype.initialise=function(t){var o=this;for(var e in o.recovery.on("reconnected",o.emits("reconnected")).on("reconnect failed",o.emits("reconnect failed",function(t){o.emit("end"),t()})).on("reconnect timeout",o.emits("reconnect timeout")).on("reconnect scheduled",o.emits("reconnect scheduled")).on("reconnect",o.emits("reconnect",function(t){o.emit("outgoing::reconnect"),t()})),o.on("outgoing::open",function(){var t=o.readyState;o.readyState=v.OPENING,t!==o.readyState&&o.emit("readyStateChange","opening")}),o.on("incoming::open",function(){var t=o.readyState;if(o.recovery.reconnecting()&&o.recovery.reconnected(),o.writable=!0,o.readable=!0,o.online||(o.online=!0,o.emit("online")),o.readyState=v.OPEN,t!==o.readyState&&o.emit("readyStateChange","open"),o.heartbeat(),o.buffer.length){var e=o.buffer.slice(),n=e.length,r=0;for(o.buffer.length=0;r<n;r++)o._write(e[r])}o.emit("open")}),o.on("incoming::ping",function(t){o.online=!0,o.heartbeat(),o.emit("outgoing::pong",t),o._write("primus::pong::"+t)}),o.on("incoming::error",function(t){var e=o.timers.active("connect"),n=t;if("string"==typeof t)n=new Error(t);else if(!(t instanceof Error)&&"object"==typeof t)for(var r in n=new Error(t.message||t.reason),t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);if(o.recovery.reconnecting())return o.recovery.reconnected(n);o.listeners("error").length&&o.emit("error",n),e&&(~o.options.strategy.indexOf("timeout")?o.recovery.reconnect():o.end())}),o.on("incoming::data",function(n){o.decoder(n,function(t,e){return t?o.listeners("error").length&&o.emit("error",t):void(o.protocol(e)||o.transforms(o,o,"incoming",e,n))})}),o.on("incoming::end",function(){var t=o.readyState;return o.disconnect?(o.disconnect=!1,o.end()):(o.readyState=v.CLOSED,t!==o.readyState&&o.emit("readyStateChange","end"),o.timers.active("connect")&&o.end(),t!==v.OPEN?!!o.recovery.reconnecting()&&o.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),o.emit("close"),~o.options.strategy.indexOf("disconnect")?o.recovery.reconnect():(o.emit("outgoing::end"),void o.emit("end"))))}),o.client(),o.ark)o.ark[e].call(o,o,t);return o.NETWORK_EVENTS&&(o.offlineHandler=function(){o.online&&(o.online=!1,o.emit("offline"),o.end(),o.recovery.reset())},o.onlineHandler=function(){o.online||(o.online=!0,o.emit("online"),~o.options.strategy.indexOf("online")&&o.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",o.offlineHandler,!1),window.addEventListener("online",o.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",o.offlineHandler),document.body.attachEvent("ononline",o.onlineHandler))),o},v.prototype.protocol=function(t){if("string"!=typeof t||0!==t.indexOf("primus::"))return!1;var e=t.indexOf(":",8),n=t.slice(e+2);switch(t.slice(8,e)){case"ping":this.emit("incoming::ping",+n);break;case"server":"close"===n&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",n);break;default:return!1}return!0},v.prototype.transforms=function(t,i,e,n,r){var s={data:n},c=t.transformers[e];return function n(r,o){var t=c[r++];if(!t)return o();if(1===t.length){if(!1===t.call(i,s))return;return n(r,o)}t.call(i,s,function(t,e){return t?i.emit("error",t):void(!1!==e&&n(r,o))})}(0,function(){return"incoming"===e?i.emit("data",s.data,r):void i._write(s.data)}),this},v.prototype.id=function(t){return this.socket&&this.socket.id?t(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",t))},v.prototype.open=function(){return y(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},v.prototype.write=function(t){return y(this,"write"),this.transforms(this,this,"outgoing",t),!0},v.prototype._write=function(t){var n=this;return v.OPEN!==n.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(t),!1):(n.encoder(t,function(t,e){return t?n.listeners("error").length&&n.emit("error",t):("string"==typeof e&&(~e.indexOf("\u2028")&&(e=e.replace(m,"\\u2028")),~e.indexOf("\u2029")&&(e=e.replace(d,"\\u2029"))),void n.emit("outgoing::data",e))}),!0)},v.prototype.heartbeat=function(){return this.options.pingTimeout&&(this.timers.clear("heartbeat"),this.timers.setTimeout("heartbeat",function(){this.online&&(this.online=!1,this.emit("offline"),this.emit("incoming::end"))},this.options.pingTimeout)),this},v.prototype.timeout=function(){var t=this;function e(){t.removeListener("error",e).removeListener("open",e).removeListener("end",e).timers.clear("connect")}return t.timers.setTimeout("connect",function(){e(),t.readyState===v.OPEN||t.recovery.reconnecting()||(t.emit("timeout"),~t.options.strategy.indexOf("timeout")?t.recovery.reconnect():t.end())},t.options.timeout),t.on("error",e).on("open",e).on("end",e)},v.prototype.end=function(t){if(y(this,"end"),this.readyState===v.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==t&&this.write(t),this.writable=!1,this.readable=!1;var e=this.readyState;return this.readyState=v.CLOSED,e!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},v.prototype.destroy=l("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),v.prototype.clone=function(t){return this.merge({},t)},v.prototype.merge=function(t){for(var e,n,r=1;r<arguments.length;r++)for(e in n=arguments[r])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t},v.prototype.parse=e("url-parse"),v.prototype.querystring=f.parse,v.prototype.querystringify=f.stringify,v.prototype.uri=function(t){var e=this.url,n=[],r=!1;t.query&&(r=!0),(t=t||{}).protocol="protocol"in t?t.protocol:"http:",t.query=!(!e.query||!r)&&e.query.slice(1),t.secure="secure"in t?t.secure:"https:"===e.protocol||"wss:"===e.protocol,t.auth="auth"in t?t.auth:e.auth,t.pathname="pathname"in t?t.pathname:this.pathname,t.port="port"in t?+t.port:+e.port||(t.secure?443:80);var o=this.querystring(t.query||"");return o._primuscb=h(),t.query=this.querystringify(o),this.emit("outgoing::url",t),n.push(t.secure?t.protocol.replace(":","s:"):t.protocol,""),n.push(t.auth?t.auth+"@"+e.host:e.host),t.pathname&&n.push(t.pathname.slice(1)),r?n[n.length-1]+="?"+t.query:delete t.query,t.object?t:n.join("/")},v.prototype.transform=function(t,e){return y(this,"transform"),t in this.transformers?(this.transformers[t].push(e),this):this.critical(new Error("Invalid transformer type"))},v.prototype.critical=function(t){if(this.emit("error",t))return this;throw t},v.connect=function(t,e){return new v(t,e)},v.EventEmitter=c,v.prototype.client=function(){var e,n=this,r=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return v.requires("ws")}catch(t){}}();if(!r)return n.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"));n.on("outgoing::open",function(){n.emit("outgoing::end");try{var t={protocol:"ws+unix:"===n.url.protocol?"ws+unix:":"ws:",query:!0};3===r.length?("ws+unix:"===t.protocol&&(t.pathname=n.url.pathname+":"+n.pathname),n.socket=e=new r(n.uri(t),[],n.transport)):(n.socket=e=new r(n.uri(t)),e.binaryType="arraybuffer")}catch(t){return n.emit("error",t)}e.onopen=n.emits("incoming::open"),e.onerror=n.emits("incoming::error"),e.onclose=n.emits("incoming::end"),e.onmessage=n.emits("incoming::data",function(t,e){t(void 0,e.data)})}),n.on("outgoing::data",function(t){if(e&&e.readyState===r.OPEN)try{e.send(t)}catch(t){n.emit("incoming::error",t)}}),n.on("outgoing::reconnect",function(){n.emit("outgoing::open")}),n.on("outgoing::end",function(){e&&(e.onerror=e.onopen=e.onclose=e.onmessage=function(){},e.close(),e=null)})},v.prototype.authorization=!0,v.prototype.pathname="/primus",v.prototype.encoder=function(t,e){var n;try{t=JSON.stringify(t)}catch(t){n=t}e(n,t)},v.prototype.decoder=function(t,e){var n;if("string"!=typeof t)return e(n,t);try{t=JSON.parse(t)}catch(t){n=t}e(n,t)},v.prototype.version="7.3.4","undefined"!=typeof document&&"undefined"!=typeof navigator&&(document.addEventListener&&document.addEventListener("keydown",function(t){27===t.keyCode&&t.preventDefault&&t.preventDefault()},!1),s=+[(i=(o=(navigator.userAgent||"").toLowerCase()).match(/.+(?:rv|it|ra|ie)[/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[])[1],i[2]].join("."),!~o.indexOf("chrome")&&~o.indexOf("safari")&&s<534.54&&(v.prototype.AVOID_WEBSOCKETS=!0)),t.exports=v},{demolish:1,emits:2,eventemitter3:3,inherits:4,querystringify:8,recovery:9,"tick-tock":12,"url-parse":14,yeast:15}]},{},[16])(16);return t.prototype.ark.emitter=function(){},t},[function(t){function e(t,e){"use strict";var n=t.prototype.initialise;function r(t,e,n){return/^(newListener|removeListener)/.test(t)||this.emitter.send.apply(this.emitter,arguments),this}t.prototype.initialise=function(){this.emitter||(this.emitter=new e(this)),this.__initialise||n.apply(this,arguments)},t.readable?t.prototype.send||t.readable("send",r):t.prototype.send=r}function n(){"use strict";var e=Object.prototype.toString,r=Array.prototype.slice,n=Array.isArray||function(t){return"[object Array]"===e.call(t)},o={EVENT:0,ACK:1};function i(t){if(!(this instanceof i))return new i(t);this.ids=1,this.acks={},this.conn=t,this.conn&&this.bind()}return i.prototype.bind=function(){var e=this;return this.conn.on("data",function(t){e.ondata.call(e,t)}),this},i.prototype.ondata=function(t){if(!n(t.data)||t.id&&"number"!=typeof t.id)return this;switch(t.type){case o.EVENT:this.onevent(t);break;case o.ACK:this.onack(t)}return this},i.prototype.send=function(){var t=r.call(arguments);return this.conn.write(this.packet(t)),this},i.prototype.packet=function(t){var e,n={type:o.EVENT,data:t};return"function"==typeof t[t.length-1]&&(e=this.ids++,this.acks[e]=t.pop(),n.id=e),n},i.prototype.onevent=function(t){var e=t.data;return this.conn.reserved(e[0])||(t.id&&e.push(this.ack(t.id)),this.conn.emit.apply(this.conn,e)),this},i.prototype.ack=function(t){var e=this.conn,n=!1;return function(){n||(n=!0,e.write({id:t,type:o.ACK,data:r.call(arguments)}))}},i.prototype.onack=function(t){var e=this.acks[t.id];return"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id]),this},i.packets=o,i}var r;void 0!==(r=t)&&(r.$=r.$||{},r.$.emitter={},r.$.emitter.spark=e,r.$.emitter.emitter=n,e(r,n()))}]);